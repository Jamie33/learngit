<!DOCTYPE html><html><head><meta charset="utf-8"></head><body><h1>​Python_3_新特性：类型注解</h1><div class="RichText ztext Post-RichText">
 <p>
  前几天有同学问到，这个写法是什么意思：
 </p>
 <div class="highlight">
  <pre><code class="language-python3"><span></span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</code></pre>
 </div>
 <p>
  我们知道 Python 是一种动态语言，变量以及函数的参数是
  <b>
   不区分类型
  </b>
  。因此我们定义函数只需要这样写就可以了：
 </p>
 <div class="highlight">
  <pre><code class="language-python3"><span></span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</code></pre>
 </div>
 <p>
  这样的好处是有极大的灵活性，但坏处就是对于别人代码，无法一眼判断出参数的类型，IDE 也无法给出正确的提示。
 </p>
 <p>
  于是 Python 3 提供了一个新的特性：
  <br/>
  <b>
   函数注解
  </b>
 </p>
 <p>
  也就是文章开头的这个例子：
 </p>
 <div class="highlight">
  <pre><code class="language-python3"><span></span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
</code></pre>
 </div>
 <p>
  用
  <code>
   : 类型
  </code>
  的形式指定函数的
  <b>
   参数类型
  </b>
  ，用
  <code>
   -&gt; 类型
  </code>
  的形式指定函数的
  <b>
   返回值
  </b>
  类型。
 </p>
 <p>
  然后特别要强调的是，Python 解释器
  <b>
   并不会
  </b>
  因为这些注解而提供额外的校验，没有任何的类型检查工作。也就是说，这些类型注解加不加，对你的代码来说
  <b>
   没有任何影响
  </b>
  ：
 </p>
 <figure>
  <noscript>
   <img class="origin_image zh-lightbox-thumb" data-caption="" data-original="https://pic1.zhimg.com/v2-9b87d43afdc941929c428b03865037c3_r.jpg" data-rawheight="530" data-rawwidth="1064" data-size="normal" src="https://pic1.zhimg.com/v2-9b87d43afdc941929c428b03865037c3_b.jpg" width="1064"/>
  </noscript>
  <img class="origin_image zh-lightbox-thumb lazy" src="https://pic1.zhimg.com/v2-9b87d43afdc941929c428b03865037c3_b.jpg" data-caption="" data-original="https://pic1.zhimg.com/v2-9b87d43afdc941929c428b03865037c3_r.jpg" data-rawheight="530" data-rawwidth="1064" data-size="normal" src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1064'%20height='530'&gt;&lt;/svg&gt;" width="1064"/>
 </figure>
 <p>
  输出：
 </p>
 <figure>
  <noscript>
   <img class="origin_image zh-lightbox-thumb" data-caption="" data-original="https://pic4.zhimg.com/v2-f00b176bddec7e1d242e3c0e13f30f33_r.jpg" data-rawheight="202" data-rawwidth="486" data-size="normal" src="https://pic4.zhimg.com/v2-f00b176bddec7e1d242e3c0e13f30f33_b.jpg" width="486"/>
  </noscript>
  <img class="origin_image zh-lightbox-thumb lazy" src="https://pic4.zhimg.com/v2-f00b176bddec7e1d242e3c0e13f30f33_b.jpg" data-caption="" data-original="https://pic4.zhimg.com/v2-f00b176bddec7e1d242e3c0e13f30f33_r.jpg" data-rawheight="202" data-rawwidth="486" data-size="normal" src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='486'%20height='202'&gt;&lt;/svg&gt;" width="486"/>
 </figure>
 <p>
  但这么做的好处是：
 </p>
 <ol>
  <li>
   让别的程序员看得更明白
  </li>
  <li>
   让 IDE 了解类型，从而提供更准确的代码提示、补全和语法检查（包括类型检查，可以看到 str 和 float 类型的参数被高亮提示）
  </li>
 </ol>
 <figure>
  <noscript>
   <img class="origin_image zh-lightbox-thumb" data-caption="" data-original="https://pic2.zhimg.com/v2-057629e3d59552c856dba7341882ea55_r.jpg" data-rawheight="631" data-rawwidth="1080" data-size="normal" src="https://pic2.zhimg.com/v2-057629e3d59552c856dba7341882ea55_b.jpg" width="1080"/>
  </noscript>
  <img class="origin_image zh-lightbox-thumb lazy" src="https://pic2.zhimg.com/v2-057629e3d59552c856dba7341882ea55_b.jpg" data-caption="" data-original="https://pic2.zhimg.com/v2-057629e3d59552c856dba7341882ea55_r.jpg" data-rawheight="631" data-rawwidth="1080" data-size="normal" src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1080'%20height='631'&gt;&lt;/svg&gt;" width="1080"/>
 </figure>
 <p>
  在函数的
  <code>
   __annotations__
  </code>
  属性中会有你设定的注解：
 </p>
 <figure>
  <noscript>
   <img class="origin_image zh-lightbox-thumb" data-caption="" data-original="https://pic4.zhimg.com/v2-9a9f55559930501472752996a3b772a4_r.jpg" data-rawheight="306" data-rawwidth="1004" data-size="normal" src="https://pic4.zhimg.com/v2-9a9f55559930501472752996a3b772a4_b.jpg" width="1004"/>
  </noscript>
  <img class="origin_image zh-lightbox-thumb lazy" src="https://pic4.zhimg.com/v2-9a9f55559930501472752996a3b772a4_b.jpg" data-caption="" data-original="https://pic4.zhimg.com/v2-9a9f55559930501472752996a3b772a4_r.jpg" data-rawheight="306" data-rawwidth="1004" data-size="normal" src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1004'%20height='306'&gt;&lt;/svg&gt;" width="1004"/>
 </figure>
 <p>
  输出：
 </p>
 <figure>
  <noscript>
   <img class="origin_image zh-lightbox-thumb" data-caption="" data-original="https://pic3.zhimg.com/v2-35506981e2c4f0e021b4b0902e36441b_r.jpg" data-rawheight="57" data-rawwidth="1080" data-size="normal" src="https://pic3.zhimg.com/v2-35506981e2c4f0e021b4b0902e36441b_b.jpg" width="1080"/>
  </noscript>
  <img class="origin_image zh-lightbox-thumb lazy" src="https://pic3.zhimg.com/v2-35506981e2c4f0e021b4b0902e36441b_b.jpg" data-caption="" data-original="https://pic3.zhimg.com/v2-35506981e2c4f0e021b4b0902e36441b_r.jpg" data-rawheight="57" data-rawwidth="1080" data-size="normal" src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1080'%20height='57'&gt;&lt;/svg&gt;" width="1080"/>
 </figure>
 <p>
  在 Python 3.6 中，又引入了对
  <b>
   变量类型
  </b>
  进行注解的方法：
 </p>
 <div class="highlight">
  <pre><code class="language-python3"><span></span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">123</span>
<span class="n">b</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">'hello'</span>
</code></pre>
 </div>
 <p>
  更进一步，如果你需要指明一个全部由整数组成的列表：
 </p>
 <div class="highlight">
  <pre><code class="language-python3"><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="n">List</span>
<span class="n">l</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
</code></pre>
 </div>
 <p>
  但同样，这些仅仅是“
  <b>
   注解
  </b>
  ”，不会对代码产生任何影响。
 </p>
 <p>
  不过，你可以通过
  <b>
   mypy
  </b>
  库来检验最终代码是否符合注解。
 </p>
 <p>
  安装 mypy：
 </p>
 <div class="highlight">
  <pre><code class="language-bash"><span></span>pip install mypy
</code></pre>
 </div>
 <p>
  执行代码：
 </p>
 <div class="highlight">
  <pre><code class="language-bash"><span></span>mypy test.py
</code></pre>
 </div>
 <p>
  如果类型都符合，则不会有任何输出，否则就会给出类似输出：
 </p>
 <figure>
  <noscript>
   <img class="origin_image zh-lightbox-thumb" data-caption="" data-original="https://pic3.zhimg.com/v2-57b0ba00b7e95b092ae6fd6acc50eb37_r.jpg" data-rawheight="58" data-rawwidth="1076" data-size="normal" src="https://pic3.zhimg.com/v2-57b0ba00b7e95b092ae6fd6acc50eb37_b.jpg" width="1076"/>
  </noscript>
  <img class="origin_image zh-lightbox-thumb lazy" src="https://pic3.zhimg.com/v2-57b0ba00b7e95b092ae6fd6acc50eb37_b.jpg" data-caption="" data-original="https://pic3.zhimg.com/v2-57b0ba00b7e95b092ae6fd6acc50eb37_r.jpg" data-rawheight="58" data-rawwidth="1076" data-size="normal" src="data:image/svg+xml;utf8,&lt;svg%20xmlns='http://www.w3.org/2000/svg'%20width='1076'%20height='58'&gt;&lt;/svg&gt;" width="1076"/>
 </figure>
 <p>
  这些新特性也许你并不会在代码中使用，不过当你在别人的代码中看到时，请按照对方的约定进行赋值或调用。
 </p>
 <p>
  当然，也不排除 Python 以后的版本把类型检查做到解释器里，谁知道呢。
 </p>
 <p>
  <br/>
  ════
  <br/>
  <i>
   其他文章及回答：
  </i>
 </p>
 <p>
  <a class="internal" href="https://www.zhihu.com/question/20702054/answer/19022301">
   如何自学Python
  </a>
  |
  <a class="internal" href="https://zhuanlan.zhihu.com/p/25824007">
   新手引导
  </a>
  |
  <a class="internal" href="https://zhuanlan.zhihu.com/p/34685564">
   精选
  </a>
  <a class="internal" href="https://zhuanlan.zhihu.com/p/34685564">
   Python
  </a>
  <a class="internal" href="https://zhuanlan.zhihu.com/p/34685564">
   问答
  </a>
  |
  <a class="internal" href="http://zhuanlan.zhihu.com/p/36064871">
   Python单词表
  </a>
  |
  <a class="internal" href="https://zhuanlan.zhihu.com/p/36538511">
   区块链
  </a>
  |
  <a class="internal" href="https://zhuanlan.zhihu.com/p/36581953">
   人工智能
  </a>
 </p>
 <p>
  欢迎关注：
  <b>
   Crossin的编程教室
  </b>
 </p>
</div></body></html>